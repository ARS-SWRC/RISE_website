<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Airtable Base Search</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .form-input {
            @apply w-full px-4 py-2 bg-gray-50 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-shadow;
        }
        .form-label {
            @apply block text-sm font-medium text-gray-700 mb-1;
        }
        .btn-primary {
            @apply w-full bg-blue-600 text-white font-semibold py-3 px-4 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-200 ease-in-out;
        }
        .result-card {
            @apply bg-white border border-gray-200 rounded-lg p-4 mb-3 shadow-sm hover:shadow-md transition-shadow;
        }
        .result-field {
            @apply text-sm text-gray-500;
        }
        .result-value {
            @apply text-base text-gray-900 font-semibold;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

    <div class="w-full max-w-4xl mx-auto p-4 md:p-8">
        <div class="bg-white rounded-xl shadow-2xl overflow-hidden">
            <div class="md:flex">
                <!-- Form Section -->
                <div class="w-full md:w-1/3 bg-gray-50 p-6 md:p-8 border-r border-gray-200">
                    <h1 class="text-2xl font-bold text-gray-900">Airtable Search</h1>
                    <p class="text-gray-600 mt-2 mb-6">Enter your credentials and search query to find records.</p>
                    
                    <form id="airtableForm" class="space-y-4">
                        <div>
                            <label for="apiKey" class="form-label">API Key</label>
                            <input type="password" id="apiKey" class="form-input" placeholder="key...">
                        </div>
                        <div>
                            <label for="baseId" class="form-label">Base ID</label>
                            <input type="text" id="baseId" class="form-input" placeholder="app...">
                        </div>
                        <div>
                            <label for="tableName" class="form-label">Table Name</label>
                            <input type="text" id="tableName" class="form-input" placeholder="e.g., 'Contacts'">
                        </div>
                        <div>
                            <label for="searchField" class="form-label">Field to Search</label>
                            <input type="text" id="searchField" class="form-input" placeholder="e.g., 'Name'">
                        </div>
                        <div>
                            <label for="query" class="form-label">Search Term</label>
                            <input type="text" id="query" class="form-input" placeholder="e.g., 'John Doe'">
                        </div>
                        <button type="submit" class="btn-primary">
                            <span id="button-text">Search</span>
                            <span id="button-spinner" class="hidden">
                                <svg class="animate-spin h-5 w-5 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                            </span>
                        </button>
                    </form>
                </div>

                <!-- Results Section -->
                <div class="w-full md:w-2/3 p-6 md:p-8">
                    <h2 class="text-xl font-bold text-gray-800">Results</h2>
                    <div id="status" class="mt-4 text-gray-600">Enter your details and click search to see results.</div>
                    <div id="results" class="mt-4 max-h-[60vh] overflow-y-auto pr-2">
                        <!-- Search results will be injected here -->
                    </div>
                </div>
            </div>
        </div>
        <footer class="text-center mt-6 text-sm text-gray-500">
            <p>Powered by the Airtable API. Your API key is sent directly to Airtable and is not stored.</p>
        </footer>
    </div>

    <script>
        const form = document.getElementById('airtableForm');
        const resultsContainer = document.getElementById('results');
        const statusContainer = document.getElementById('status');
        const buttonText = document.getElementById('button-text');
        const buttonSpinner = document.getElementById('button-spinner');

        form.addEventListener('submit', async (event) => {
            event.preventDefault();
            
            // 1. Get user input
            const apiKey = document.getElementById('apiKey').value.trim();
            const baseId = document.getElementById('baseId').value.trim();
            const tableName = document.getElementById('tableName').value.trim();
            const searchField = document.getElementById('searchField').value.trim();
            const query = document.getElementById('query').value.trim();

            // 2. Basic validation
            if (!apiKey || !baseId || !tableName || !searchField || !query) {
                statusContainer.textContent = 'Error: Please fill in all fields.';
                statusContainer.className = 'mt-4 text-red-600 font-semibold';
                resultsContainer.innerHTML = '';
                return;
            }

            // 3. Show loading state
            resultsContainer.innerHTML = '';
            statusContainer.textContent = 'Searching...';
            statusContainer.className = 'mt-4 text-blue-600 font-semibold';
            buttonText.classList.add('hidden');
            buttonSpinner.classList.remove('hidden');
            form.querySelector('button').disabled = true;

            try {
                // 4. Construct the API request
                // We URL-encode the table name and the formula to handle spaces and special characters.
                const encodedTableName = encodeURIComponent(tableName);
                // This formula finds records where the search term appears anywhere in the specified field (case-insensitive).
                const formula = `SEARCH(LOWER("${query}"), LOWER({${searchField}}))`;
                const encodedFormula = encodeURIComponent(formula);
                
                const url = `https://api.airtable.com/v0/${baseId}/${encodedTableName}?filterByFormula=${encodedFormula}`;

                // 5. Make the fetch call to Airtable API
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${apiKey}`
                    }
                });

                // 6. Handle the response
                // Specifically check for 404 error, which is common with wrong Base ID or Table Name.
                if (response.status === 404) {
                    throw new Error("Not Found (404). Please double-check your Base ID and Table Name. They are case-sensitive.");
                }

                const data = await response.json();

                if (!response.ok) {
                    // Airtable provides helpful error messages in the response body
                    const errorMessage = data.error?.message || `HTTP Error: ${response.status} - ${response.statusText}`;
                    throw new Error(errorMessage);
                }

                if (data.records && data.records.length > 0) {
                    statusContainer.textContent = `Found ${data.records.length} record(s).`;
                    statusContainer.className = 'mt-4 text-green-600 font-semibold';
                    renderResults(data.records);
                } else {
                    statusContainer.textContent = 'No records found matching your query.';
                    statusContainer.className = 'mt-4 text-gray-600';
                }

            } catch (error) {
                statusContainer.textContent = `Error: ${error.message}`;
                statusContainer.className = 'mt-4 text-red-600 font-semibold';
                console.error('Airtable API Error:', error);
            } finally {
                // 7. Reset loading state
                buttonText.classList.remove('hidden');
                buttonSpinner.classList.add('hidden');
                form.querySelector('button').disabled = false;
            }
        });

        function renderResults(records) {
            resultsContainer.innerHTML = ''; // Clear previous results
            records.forEach(record => {
                const card = document.createElement('div');
                card.className = 'result-card';
                
                let cardContent = `<h3 class="text-lg font-bold text-blue-700 mb-2">Record ID: ${record.id}</h3>`;
                
                // Display all fields from the record
                for (const field in record.fields) {
                    cardContent += `
                        <div>
                            <span class="result-field">${field}:</span>
                            <span class="result-value">${JSON.stringify(record.fields[field])}</span>
                        </div>
                    `;
                }
                
                card.innerHTML = cardContent;
                resultsContainer.appendChild(card);
            });
        }
    </script>
</body>
</html>
